---
# Run basic tests for this app on the latest aiidalab-docker image.

name: continuous-integration

on: [push, pull_request]

jobs:
    test:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v2

            - name: Build Docker image
              run: |
                  docker build -t aiidalab/full-stack-with-browsers:latest tests/

            - name: Run tests
              env:
                  JUPYTER_TOKEN: ${{ secrets.JUPYTER_TOKEN }}
              run: |
                  DOCKER_ID=$(docker run -d --rm -v $(pwd):/home/jovyan/apps/aiidalab-widgets-base -e JUPYTER_TOKEN=${JUPYTER_TOKEN} aiidalab/full-stack-with-browsers:latest)
                  docker exec ${DOCKER_ID} bash -c "cd apps/aiidalab-widgets-base && pip install -e.[dev,smiles]"
                  docker exec ${DOCKER_ID} bash -c "cd apps/aiidalab-widgets-base && pytest --driver Chrome"
                  docker stop ${DOCKER_ID}
